<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extend the tablet view to include weight tracking fields when enabled -->
    <record id="mrp_workorder_view_form_tablet_weight" model="ir.ui.view">
        <field name="name">mrp.workorder.view.form.tablet.weight</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp_workorder.mrp_workorder_view_form_tablet"/>
        <field name="arch" type="xml">
            <!-- Add weight tracking fields as invisible -->
            <xpath expr="//field[@name='state']" position="after">
                <field name="has_weight_tracking" invisible="1"/>
                <field name="weight_captured_at_start" invisible="1"/>
                <field name="weight_captured_at_end" invisible="1"/>
                <field name="paint_product_id" invisible="1"/>
                <field name="start_weight" invisible="1"/>
                <field name="end_weight" invisible="1"/>
                <field name="delta_weight" invisible="1"/>
                <field name="weight_uom_id" invisible="1"/>
            </xpath>
            
            <!-- Add weight tracking section in the main form -->
            <xpath expr="//div[@class='o_workorder_bar'][last()]" position="after">
                <!-- Weight Tracking Section - Only visible when enabled -->
                <div class="o_workorder_bar" invisible="not has_weight_tracking" style="background-color: #e8f5e8; border: 2px solid #28a745;">
                    <div class="o_workorder_bar_left o_workorder_bar_content">
                        <div class="o_workorder_field">
                            <h5 style="color: #155724; margin: 5px 0;">ðŸŽ¨ Paint Weight Tracking</h5>
                            <field name="paint_product_id" readonly="1" options="{'no_open': True}" string="Paint:"/>
                        </div>
                    </div>
                    <div class="o_workorder_bar_center o_workorder_bar_content">
                        <div class="o_workorder_field">
                            <button name="action_capture_start_weight" type="object" 
                                    class="btn btn-warning btn-lg me-2"
                                    invisible="weight_captured_at_start"
                                    string="ðŸ“ Enter Start Weight"/>
                            <div invisible="not weight_captured_at_start" class="alert alert-success p-2">
                                <strong>Start: </strong>
                                <field name="start_weight" readonly="1" class="fw-bold"/>
                                <field name="weight_uom_id" readonly="1"/>
                            </div>
                        </div>
                    </div>
                    <div class="o_workorder_bar_right o_workorder_bar_content">
                        <div class="o_workorder_field">
                            <button name="action_capture_end_weight" type="object" 
                                    class="btn btn-primary btn-lg"
                                    invisible="not weight_captured_at_start or weight_captured_at_end"
                                    string="ðŸ“ Enter End Weight"/>
                            <div invisible="not weight_captured_at_end" class="alert alert-info p-2">
                                <strong>End: </strong>
                                <field name="end_weight" readonly="1" class="fw-bold"/>
                                <field name="weight_uom_id" readonly="1"/>
                                <br/>
                                <strong>Used: </strong>
                                <field name="delta_weight" readonly="1" class="fw-bold text-danger"/>
                                <field name="weight_uom_id" readonly="1"/>
                            </div>
                        </div>
                    </div>
                </div>
            </xpath>
        </field>
    </record>
    
</odoo>